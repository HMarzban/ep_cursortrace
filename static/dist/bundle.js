"use strict";Object.defineProperty(exports,"__esModule",{value:!0});let e,t=!1,n=0;const o=e=>{const t=$("<div></div>"),a=e.contents().clone();if(a)return a.each((function(){if(3===this.nodeType){let e="";const o=this.wholeText;for(let t=0;t<o.length;t++)" "===o[t]?e+=`<span data-key=${n}> </span>`:e+=`<span data-key=${n}>${o[t]}</span>`,n++;t.append($(e))}else $(this).html(o($(this))),t.append($(this))})),t.html()};exports.aceEditEvent=(n,o)=>{if(("handleClick"===o.callstack.editEvent.eventType||"handleKeyEvent"===o.callstack.type||"idleWorkTimer"===o.callstack.type)&&t){const t=o.rep.selStart[0],n=o.rep.selStart[1];if(!e||t!==e[0]||n!==e[1]){const o=pad.getUserId(),a={type:"cursor",action:"cursorPosition",locationY:t,locationX:n,padId:pad.getPadId(),myAuthorId:o};e=[],e[0]=t,e[1]=n,pad.collabClient.sendMessage(a)}}},exports.aceEditorCSS=(e,t)=>["/ep_cursortrace/static/css/cursortrace.css"],exports.aceInitInnerdocbodyHead=(e,t,n)=>{t.iframeHTML.push('<link rel="stylesheet" type="text/css" href="../static/plugins/ep_cursortrace/static/css/ace_inner.css"/>'),n()},exports.className2Author=e=>{if("author-"===e.substring(0,7))return e.substring(7).replace(/[a-y0-9]+|-|z.+?z/g,(e=>"-"===e?".":"z"===e.charAt(0)?String.fromCharCode(Number(e.slice(1,-1))):e))},exports.getAuthorClassName=e=>{if(!e)return!1;return`ep_real_time_chat-${e.replace(/[^a-y0-9]/g,(e=>"."===e?"-":`z${e.charCodeAt(0)}z`))}`},exports.handleClientMessage_CUSTOM=(e,t,a)=>{const s=t.payload.action,r=t.payload.authorId;if(pad.getUserId()===r)return!1;const i=exports.getAuthorClassName(r),c=$('iframe[name="ace_outer"]').contents().find("iframe").contents().find("html").find("#inerDocMirror").contents();if("cursorPosition"===s){let e=t.payload.authorName;"null"!==e&&null!=e||(e="ðŸ˜Š");const a=t.payload.locationY+1;let s=t.payload.locationX,d=!1;const l=$('iframe[name="ace_outer"]').contents().find("iframe").contents().find("#innerdocbody").find(`div:nth-child(${a})`);if(0!==l.length){let t=$(l).offset().top;const a=$(l).html(),p=`hiddenUgly${exports.getAuthorClassName(r)}`;$(l).children("span").length<1&&(s-=1);const h=((e,t)=>{const n=document.createElement("div");n.innerHTML=e;const o=(e,t)=>{let n=e.firstChild;if(n)do{3===n.nodeType?t(n):1===n.nodeType&&n.childNodes&&n.childNodes[0]&&o(n,t)}while(n=n.nextSibling)};return o(n,(e=>{if(t>0){const n=e.data.length;(t-=n)<=0&&(e.data=e.substringData(0,e.data.length+t))}else e.data=""})),n.innerHTML})(a,s),f=`\n        <span\n          style="display:block"\n          id='${p}'\n          class='ghettoCursorXPos'\n        >\n         ${h}\n        </span>\n      `;n=0,c.find("body").append(f);const u=c.find(`body #${p}`);$(u).html(o($(u)));const m=$(u).find("[data-key]").last(),g=$(u).find("span[class^='author-']").find("[data-key]").last();let y;y=0!==m.length?m.position().left:0,g.length&&(y=g.position().left+g.width());const b=u.height();t=t+b-(g.height()+13),t<=0&&(d=!0,t+=2*g.height(),t<0&&(t=0));const x=g.closest(":header");x.length&&(t-=parseInt(x.css("marginTop"))-13,y+=2*parseInt($(u).parent().css("paddingLeft"))),c.find(`body #${p}`).remove();const k=pad.collabClient.getConnectedUsers(),C=$('iframe[name="ace_outer"]').contents().find("iframe").contents().find("html");$.each(k,((n,o)=>{if(o.userId===r){const n=pad.getColorPalette();let a;a=n[o.colorId]?n[o.colorId]:o.colorId,C.find(`.caret-${i}`).remove();const s=d?"stickUp":"stickDown",r=$(`\n            <div \n              class='caretindicator ${s} caret-${i}'\n              style='height:16px;left:${y}px;top:${t}px;background-color:${a}'\n            >\n              <p class='stickp ${s}'></p>\n            </div>\n          `);r.attr("title",e),r.find("p").text(e),$(C).append(r)}}))}}return a()},exports.postAceInit=(e,n,o)=>{t=!0;const a=$('iframe[name="ace_outer"]').contents().find('iframe[name="ace_inner"]').contents(),s=a.find("html"),r=a.find("head link").clone(!0);let i=document.createElement("iframe");i.id="inerDocMirror",i=$(i).css({position:"fixed",width:"100%",margin:"auto",left:"50%",transform:"translateX(-50%)",border:"none",background:"purple","z-index":"-999",opacity:"0"}),s.prepend(i),s.find("#inerDocMirror").contents().find("head").html(r),s.find("#inerDocMirror").contents().find("body").attr({id:"innerdocbody",class:"innerdocbody doesWrap ltr static",style:"overflow: hidden"}),o()};//# sourceMappingURL=bundle.js.map
